syntax = "proto3";
import "common.proto";
import "promotion/promotion-condition.proto";
import "promotion/promotion-effect.proto";
import "promotion/travel-context.proto";
import "travel/travel-solution.proto";
option java_multiple_files = true;
option java_package = "it.trenical.promotion.proto";
package promo;


service PromotionService {
  rpc RegisterPromotion(PromotionMessage) returns (Empty);
  rpc GetAllPromotions(GetAllPromotionsRequest) returns (stream PromotionMessage);
  rpc UpdatePromotionState(UpdatePromotionRequest) returns (Empty);
  rpc GetPromotionById(GetPromotionRequest) returns (PromotionMessage);

  rpc ApplyPromotions(ApplyPromotionRequest) returns (ApplyPromotionResponse);

  rpc SubscribeToFidelity(SubscribeToFidelityRequest) returns (Empty);
  rpc UnsubscribeToFidelity(UnsubscribeToFidelityRequest) returns (Empty);
  rpc GetFidelitySubscriptionInfo(GetSubscriptionInfoRequest) returns (GetSubscriptionInfoResponse);
  rpc ListenToFidelityPromotions(ListenPromotionRequest) returns (stream PromotionMessage);
}

message GetAllPromotionsRequest {
  bool showDisabled = 1;
}

message GetPromotionRequest {
  string id = 1;
}

message UpdatePromotionRequest {
  string id = 1;
  bool enable = 2;
}

message PromotionMessage {
  string id = 1;
  string name = 2;
  string description = 3;
  repeated promotion.PromotionCondition conditions = 4;
  promotion.PromotionEffect effect = 5;
}

message ApplyPromotionRequest {
  travel.TravelSolution solution = 1;
}

message ApplyPromotionResponse {
  travel.TravelSolution solution = 1;
}

message SubscribeToFidelityRequest {
  string username = 1;
}

message UnsubscribeToFidelityRequest {
  string username = 1;
}

message GetSubscriptionInfoRequest {
  string username = 1;
}

message GetSubscriptionInfoResponse {
  bool subscribed = 1;
  int64 fromDate = 2;
}

message ListenPromotionRequest {
  string username = 1;
}