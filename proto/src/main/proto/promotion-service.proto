syntax = "proto3";
import "common.proto";
import "promotion/promotion-condition.proto";
import "promotion/promotion-effect.proto";
import "promotion/travel-context.proto";
import "travel/travel-solution.proto";
option java_multiple_files = true;
option java_package = "it.trenical.promotion.proto";
package promo;

service PromotionService {
  rpc RegisterPromotion(PromotionMessage) returns (Empty);
  rpc UpdatePromotion(PromotionMessage) returns (Empty);
  rpc RemovePromotion(RemovePromotionRequest) returns (Empty);
  rpc GetAllPromotions(GetAllPromotionsRequest) returns (stream PromotionMessage);
  rpc GetPromotionById(GetPromotionRequest) returns (PromotionMessage);

  rpc ApplyPromotions(ApplyPromotionRequest) returns (ApplyPromotionResponse);

  rpc SubscribeToLoyalty(SubscribeToLoyaltyRequest) returns (Empty);
  rpc UnsubscribeToLoyalty(UnsubscribeToLoyaltyRequest) returns (Empty);
  rpc GetLoyaltySubscriptionInfo(GetSubscriptionInfoRequest) returns (GetSubscriptionInfoResponse);
  rpc ListenToLoyaltyPromotions(ListenPromotionRequest) returns (stream PromotionMessage);
}

message GetAllPromotionsRequest {
  bool showDisabled = 1;
}

message GetPromotionRequest {
  string id = 1;
}

message RemovePromotionRequest {
  string id = 1;
}

message PromotionMessage {
  string id = 1;
  string name = 2;
  string description = 3;
  repeated promotion.PromotionCondition conditions = 4;
  promotion.PromotionEffect effect = 5;
}

message ApplyPromotionRequest {
  travel.TravelSolution solution = 1;
}

message ApplyPromotionResponse {
  travel.TravelSolution solution = 1;
}

message SubscribeToLoyaltyRequest {
  string username = 1;
}

message UnsubscribeToLoyaltyRequest {
  string username = 1;
}

message GetSubscriptionInfoRequest {
  string username = 1;
}

message GetSubscriptionInfoResponse {
  bool subscribed = 1;
  int64 fromDate = 2;
}

message ListenPromotionRequest {
  string username = 1;
}